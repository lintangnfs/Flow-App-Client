<mat-progress-bar *ngIf="value > 0" [value]='value' color='primary'></mat-progress-bar>
<div class="page-header">
    <h1>Algoritma Alpha Miner</h1>
</div>

<div class="page-content">
    <mat-horizontal-stepper labelPosition='bottom' (selectionChange)='stepChange($event)'>
        <mat-step>
            <ng-template matStepLabel>Transition</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>1. Transition</mat-card-title>
                    <mat-card-subtitle>First step of Alpha Miner Algorithm </mat-card-subtitle>
                </mat-card-header>
                <mat-card-content >
                    <mat-accordion>
                        <mat-expansion-panel expanded>
                            <mat-expansion-panel-header>
                                <mat-panel-title (click)="raw()">
                                    Data 
                                </mat-panel-title>
                                <mat-panel-description>
                                    Data that used for Alpha Miner Algorithm
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <div [ngStyle]="{'display': display}">
                                <div class="mat-elevation-z8" >
                                    <table mat-table matSort [dataSource]="eventLog">
                                        <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumns">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ column }} </th>
                                            <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
                                        <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
                                    </table>
                                    <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
                                </div>
                            </div>
                        </mat-expansion-panel>
                        <mat-expansion-panel>
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    Transition
                                </mat-panel-title>
                                <mat-panel-description>
                                    All transition in event log
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            
                        </mat-expansion-panel>
                    </mat-accordion>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Start Activities</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Alias Data</mat-card-title>
                    <mat-card-subtitle>Give alias to your data and filter out certain value that not needed</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content *ngIf="aliasReady">
                    <mat-form-field>
                        <mat-select [(value)]='selectedValueAlias' placeholder="Choose Column" required (selectionChange)="aliasColumnChoosen($event, alias)" style="width: 100%;">
                            <mat-option *ngFor="let col of aliasColumn" [value]="col">{{ col }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <form #alias="ngForm" (ngSubmit)="submitAlias(alias)">
                        <div *ngIf="aliasChoosenColumn">
                            <div>
                                <button mat-stroked-button type="button" (click)="fillNumber()" style="float: right;" color='primary'>Fill Number</button>
                                <button mat-stroked-button type="button" (click)="originalValue()" style="float: right;" color='primary'>Current Value</button>
                                <h4>Value List</h4>
                                <small>Leave out the value that you want to get rid off</small><br><br>
                                <mat-slide-toggle (change)='toggleNewColumn($event)'>New Column</mat-slide-toggle><br>
                                <mat-form-field style="margin-top: 8px;">
                                    <input matInput id='newColumnName' name='newColumnName' type="text" placeholder='Name for the new column' ngModel [disabled]='!newColumn' [required]='!newColumn'>
                                </mat-form-field>
                            </div>
                            <br>
                            <mat-grid-list cols="4" rowHeight="60px">
                                <mat-grid-tile *ngFor="let data of aliasData[aliasChoosenColumn], let i = index">
                                    <mat-form-field style="width: 100%;">
                                        <input matInput [id]='data' [name]='data' type="text" [placeholder]='data' [(ngModel)]='aliasValue[i]'>
                                    </mat-form-field>
                                    <button type="button" mat-button mat-icon-button aria-label="Clear" (click)="aliasValue[i]=data">
                                        <mat-icon>assignment</mat-icon>
                                    </button>
                                    <button [id]='i' type="button" mat-button (click)="value=i" style="display: none;"></button>
                                </mat-grid-tile>
                            </mat-grid-list>
                            <button mat-raised-button id="aliasSubmit" type="submit" name="submit" class="button" style="display: none;">Submit</button>
                        </div>
                    </form>
                    </mat-card-content>
                    <mat-card-actions *ngIf="aliasReady" style='padding-bottom: 8px;padding-left: 8px;'>
                        <button mat-raised-button matStepperPrevious>Back</button>
                        <button mat-raised-button matStepperNext>Next</button>
                        <button *ngIf="aliasChoosenColumn" mat-raised-button onclick="aliasSubmit.click();" style="float: right;" color='primary'>Submit</button>
                        <br>
                </mat-card-actions>
            </mat-card>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>End Activities</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Count Attempt</mat-card-title>
                    <mat-card-subtitle>Count attempt per case</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content *ngIf="attemptReady">
                    <form *ngIf="attemptColumn" #attempt='ngForm' (ngSubmit)='submitAttempt(attempt)'>
                        <mat-form-field style="width: 100%;">
                            <mat-select name='base' placeholder="Base Column" required ngModel>
                                <mat-option *ngFor="let col of attemptColumn" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;">
                            <mat-select name='col' placeholder="Count Column" required ngModel (selectionChange)="attemptChooseColumn($event)">
                                <mat-option *ngFor="let col of attemptColumn" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;" *ngIf="attemptChoosenColumn">
                            <mat-select name='start' placeholder="Start Event" required ngModel>
                                <mat-option *ngFor="let col of attemptData[attemptChoosenColumn]" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;" *ngIf="attemptChoosenColumn">
                            <mat-select name='end' placeholder="End Event" required ngModel>
                                <mat-option *ngFor="let col of attemptData[attemptChoosenColumn]" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <button mat-raised-button matStepperPrevious type='button' style='margin-right: 8px;'>Back</button>
                        <button mat-raised-button matStepperNext type='button'>Next</button>
                        <button mat-raised-button id="attemptSubmit" type="submit" name="submit" class="button" style="float: right;" color='primary' [disabled]='attempt.invalid'>Submit</button>
                    </form>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Extract Relation</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Extract Relation</mat-card-title>
                    <mat-card-subtitle>Join two column to new column</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content *ngIf="joinReady">
                    <form *ngIf="joinColumn" #join='ngForm' (ngSubmit)='submitJoin(join)'>
                        <mat-form-field style="width: 100%;">
                            <mat-select name='col1' placeholder="First Column" required ngModel>
                                <mat-option *ngFor="let col of joinColumn" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;">
                            <mat-select name='col2' placeholder="Second Column" required ngModel>
                                <mat-option *ngFor="let col of joinColumn" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;">
                            <input matInput name='name' type="text" placeholder='New column name' ngModel required>
                        </mat-form-field>
                        <mat-form-field style="width: 100%;">
                            <input matInput name='delimiter' type="text" placeholder='Delimiter that will be used to separate value from those column' ngModel>
                        </mat-form-field>
                        <button mat-raised-button matStepperPrevious type='button' style='margin-right: 8px;'>Back</button>
                        <button mat-raised-button matStepperNext type='button'>Next</button>
                        <button mat-raised-button id="joinSubmit" type="submit" name="submit" class="button" style="float: right;" color='primary' [disabled]='join.invalid'>Submit</button>
                    </form>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Compute Pairs</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Compute Pairs</mat-card-title>
                    <mat-card-subtitle>Drop column that aren't needed</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content *ngIf="dropReady">
                    <form *ngIf="dropColumn" #drop='ngForm' (ngSubmit)='submitDrop(drop)'>
                        <mat-form-field style="width: 100%;">
                            <mat-select name='col' placeholder="Column that will be dropped" required ngModel>
                                <mat-option *ngFor="let col of dropColumn" [value]="col">{{ col }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <button mat-raised-button matStepperPrevious type='button' style='margin-right: 8px;'>Back</button>
                        <button mat-raised-button matStepperNext type='button'>Next</button>
                        <button mat-raised-button id="dropSubmit" type="submit" name="submit" class="button" style="float: right;" color='primary' [disabled]='drop.invalid'>Submit</button>
                    </form>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Extract Maximal Pairs</ng-template>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Choose Column</mat-card-title>
                    <mat-card-subtitle>Chosse 3 column that will be used as case id, event and timestamp</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content *ngIf="chooseReady">
                    <form #choose="ngForm" (ngSubmit)="submitChoose(choose)">
                        <h4>Case ID</h4>
                        <mat-form-field style="width: 100%;">
                            <mat-select placeholder="case id" name='case_id' [(ngModel)]='case_id' required>
                                <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <h4>Event</h4>
                        <mat-form-field style="width: 100%;">
                            <mat-select placeholder="event" name='event' [(ngModel)]='event' required>
                                <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <h4>Timestamp</h4>
                        <mat-form-field style="width: 100%;">
                            <mat-select placeholder="timestamp" name='timestamp' [(ngModel)]='timestamp' required>
                                <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <button mat-raised-button matStepperPrevious type='button'>Back</button>
                        <button mat-raised-button id='chooseSubmit' type="submit" name="submit" class="button" color="primary" style="float: right;" color='primary' [disabled]='choose.invalid'>Submit</button>
                    </form>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step>
          <ng-template matStepLabel>Add Places</ng-template>
          <mat-card>
              <mat-card-header>
                  <mat-card-title>Choose Column</mat-card-title>
                  <mat-card-subtitle>Chosse 3 column that will be used as case id, event and timestamp</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content *ngIf="chooseReady">
                  <form #choose="ngForm" (ngSubmit)="submitChoose(choose)">
                      <h4>Case ID</h4>
                      <mat-form-field style="width: 100%;">
                          <mat-select placeholder="case id" name='case_id' [(ngModel)]='case_id' required>
                              <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                          </mat-select>
                      </mat-form-field>
                      <h4>Event</h4>
                      <mat-form-field style="width: 100%;">
                          <mat-select placeholder="event" name='event' [(ngModel)]='event' required>
                              <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                          </mat-select>
                      </mat-form-field>
                      <h4>Timestamp</h4>
                      <mat-form-field style="width: 100%;">
                          <mat-select placeholder="timestamp" name='timestamp' [(ngModel)]='timestamp' required>
                              <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                          </mat-select>
                      </mat-form-field>
                      <button mat-raised-button matStepperPrevious type='button'>Back</button>
                      <button mat-raised-button id='chooseSubmit' type="submit" name="submit" class="button" color="primary" style="float: right;" color='primary' [disabled]='choose.invalid'>Submit</button>
                  </form>
              </mat-card-content>
          </mat-card>
      </mat-step>
      <mat-step>
        <ng-template matStepLabel>Extract Petri Net</ng-template>
        <mat-card>
            <mat-card-header>
                <mat-card-title>Choose Column</mat-card-title>
                <mat-card-subtitle>Chosse 3 column that will be used as case id, event and timestamp</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content *ngIf="chooseReady">
                <form #choose="ngForm" (ngSubmit)="submitChoose(choose)">
                    <h4>Case ID</h4>
                    <mat-form-field style="width: 100%;">
                        <mat-select placeholder="case id" name='case_id' [(ngModel)]='case_id' required>
                            <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <h4>Event</h4>
                    <mat-form-field style="width: 100%;">
                        <mat-select placeholder="event" name='event' [(ngModel)]='event' required>
                            <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <h4>Timestamp</h4>
                    <mat-form-field style="width: 100%;">
                        <mat-select placeholder="timestamp" name='timestamp' [(ngModel)]='timestamp' required>
                            <mat-option *ngFor="let h of chooseData; let i = index" [value]="i">{{ h }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button mat-raised-button matStepperPrevious type='button'>Back</button>
                    <button mat-raised-button id='chooseSubmit' type="submit" name="submit" class="button" color="primary" style="float: right;" color='primary' [disabled]='choose.invalid'>Submit</button>
                </form>
            </mat-card-content>
        </mat-card>
    </mat-step>
    </mat-horizontal-stepper>
</div>


